# 色带处理

## 色带是如何产生的？

俗话说知己知彼，百战不殆，要对付色带这一号敌人，了解色带是如何产生的非常重要。

首先，色带往往出现在画面中的平面部分，大面积的色块往往是色带集中出现的区域，同时，一些渐变场景也常常会看到它。在现在的显示设备上，我们常常采用8bit每通道的RGB来量化色彩灰阶并显示画面。也就是说，RGB每个通道可以有256种灰阶表示，我们总共能显示的颜色种类就有256\*256\*256，也就是16777216种颜色。

你可能会说：好耶！有那么多颜色能表示，怎么会出现色带呢！

其实很简单，最简单粗暴的试想一下，屏幕上出现了一条从黑到白的线条，从最左到最右总长1920个像素，那每一个灰度区间如果从**线性的角度**讲，一个区间会长约7.5个像素，那区间和区间之间就会出现明显的一条痕迹，这就是色带的来历。所以，8bit下无论怎样都很有可能会出现色带，只是你能不能看得出而已。

当然了，上面特意提到了线性的角度，那么实际上，我们日常看的显示器内容，都是已经经过gamma校正了的，关于gamma校正这里不想细究，它的作用是通过重新分配灰度系数，让对黑暗不敏感，亮部敏感的人眼能够更清晰的看到画面中偏黑的区域。简单的来说，你看到的灰阶从最暗到最亮的分配并不是均匀的，越黑的部分分配的灰阶越多，这听起来可能有点怪，但是通过下图我们可以直观的感受到区别。

![&#x8FD9;&#x662F;&#x539F;&#x59CB;&#x7684;8bit&#x9ED1;&#x767D;&#x6E10;&#x53D8;&#x56FE;](https://i.v2ex.co/v795yRN9.jpeg)

如果我们用5bit（32位）来表示的话，那么必然会出现色彩断层，但是线性分布和gamma校正后的感觉会完全不同

![&#x5982;&#x679C;&#x662F;&#x7EBF;&#x6027;&#x5206;&#x5E03;&#x7684;&#x8BDD;&#xFF0C;&#x6697;&#x5904;&#x7684;&#x65AD;&#x5C42;&#x4F1A;&#x5F88;&#x660E;&#x663E;](https://i.v2ex.co/dl4oxx5T.png)

![&#x4F46;&#x662F;gamma&#x6821;&#x6B63;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x7684;&#x4EAE;&#x5EA6;&#x5C31;&#x975E;&#x5E38;&#x5747;&#x5300;&#x4E86;](https://i.v2ex.co/9fQ3rkp1.png)

Gamma的出现虽然让人眼对画面的光暗得到了巨大的提升，但是它也打破了灰度的均匀分配，让色带更可能出现了。

## 那么，色带要如何解决呢？

其实方法总结下来就是两点，要么添加噪点，要么就将构成色带的像素替换为临近像素的中间值（其实就是一个字，抹！）

### 加噪：

很显然的，由于我们是人类，眼神十分的堪忧，没有经过特别的训练和熟悉一般很难看出色带，所以加点噪点可以更进一步的混淆人眼，让我们感觉不出色带的存在。

![&#x4EBA;&#x4E3A;&#x5236;&#x9020;&#x7684;&#x6709;&#x8272;&#x5E26;&#x7684;&#x793A;&#x4F8B;&#xFF08;&#x6CE8;&#x610F;&#x5899;&#x58C1;&#x4E0A;&#x7684;&#x8272;&#x5E26;&#xFF09;](https://i.v2ex.co/5633z3HVl.png)

![&#x52A0;&#x566A;&#x4E4B;&#x540E;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x5C31;&#x4E0D;&#x660E;&#x663E;&#x591A;&#x4E86;](https://i.v2ex.co/U00w7zPvl.png)

当然，这样无脑的加噪会影响观感，而且效果也只能算凑合。我们接触打大部分BDMV都会为了防止色带打上一层不痛不痒的噪点，这么做属于治标不治本的办法，但是保留噪点作为去色带操作后的保底是一个不错的选择，万一色带没抹干净好歹还有层噪点做遮羞布，其实也挺好的。

如果想要加噪，最直接的方法就是使用[AddGrain](https://github.com/HomeOfVapourSynthEvolution/VapourSynth-AddGrain)来进行：

`addgrain = core.grain.Add(res,1.0)`

### 抹:

抹这个操作就字如其名了，检测色带，针对色带进行平滑就是抹的主要目的，我们常常使用f3kdb来进行去色带操作

待续。。。









